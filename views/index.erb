<html>
<head>
	<style>
		<% if victory %>
			body{
				background: -webkit-linear-gradient(-90deg, rgba(248,252,10,1) 0, rgba(248,252,10,1) 3%, rgba(219,167,118,1) 26%, rgba(58,132,195,1) 57%, rgba(10,16,91,1) 100%);
  			background: -moz-linear-gradient(180deg, rgba(248,252,10,1) 0, rgba(248,252,10,1) 3%, rgba(219,167,118,1) 26%, rgba(58,132,195,1) 57%, rgba(10,16,91,1) 100%);
  			background: linear-gradient(180deg, rgba(248,252,10,1) 0, rgba(248,252,10,1) 3%, rgba(219,167,118,1) 26%, rgba(58,132,195,1) 57%, rgba(10,16,91,1) 100%);
			}
		<% else %>
			body{
				background-color: black;
				background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px), radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px), radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 40px), radial-gradient(rgba(255,255,255,.4), rgba(255,255,255,.1) 2px, transparent 30px);
				background-size: 550px 550px, 350px 350px, 250px 250px, 150px 150px; 
				background-position: 0 0, 40px 60px, 130px 270px, 70px 100px;
			}			
		<% end %>

		#victory-notification{
				background: yellow;
				height: 50px;				
				padding: 0 25% 0 22%;
				margin: 0 2px 5px 2px;
				border: 1px solid black;
			}
		
		.center{			
			margin: 15px auto;
	  	width: 400px;
	  	height: 660px;
	  	border: 5px solid #000066;
	  	padding: 10px;
	  	background-color: #6d695c;
			background-image: repeating-linear-gradient(120deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px), repeating-linear-gradient(60deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px), linear-gradient(60deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1)), linear-gradient(120deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1));
			background-size: 70px 120px; 		  	
		}
		.circle{
			width: 40px;
			height: 40px;
			background: grey;
			-moz-border-radius: 50%;
			-webkit-border-radius: 50%;
			border-radius: 50%;
			margin: 5px auto 5px auto;			
		}		
		.oval{
			width: 200px;
			height: 50px;
			display: table;
			-moz-border-radius: 100px / 25px;
			-webkit-border-radius: 100px / 25px;
			border-radius: 100px / 25px;			
			margin: 3px auto 4px auto;
			color: rgba(0,0,0,0.9);
  -o-text-overflow: clip;
  text-overflow: clip;
  background: -webkit-linear-gradient(-90deg, rgba(252,234,187,1) 0, rgba(252,205,77,1) 50%, rgba(248,181,0,1) 51%, rgba(251,223,147,1) 100%);
  background: -moz-linear-gradient(180deg, rgba(252,234,187,1) 0, rgba(252,205,77,1) 50%, rgba(248,181,0,1) 51%, rgba(251,223,147,1) 100%);
  background: linear-gradient(180deg, rgba(252,234,187,1) 0, rgba(252,205,77,1) 50%, rgba(248,181,0,1) 51%, rgba(251,223,147,1) 100%);
  background-position: 50% 50%;   
   /*box-shadow: 0 0 7px 4px rgba(249,241,7,0.83) ;*/
		}
		.oval span{
			display: table-cell;
			vertical-align: middle;
			text-align:center;
			padding: 0 15px;
		}

		/*= table*/
		#board{
			margin: 0px auto 0px auto;
		}
		.table{
		  display: table;
		  width: 100%;		  
		  border-collapse:collapse;		  
		}
		.table-row{
			display: table-row;
			padding: 0px;			
		}
		.table-cell{
			display: table-cell;      
      /*border:#f0f0f0 1px solid;*/
      vertical-align: middle;
		}
		/*result table*/
		.results{
			padding: 0;
		}
		.table-2{
		  display: table;
		  width: 100%;
		  height: 100%;
		  border-collapse:collapse;		  
		}
		.table-2 .table-row{
			display: table-row;
			height: 20px;
		}
		.table-2 .table-cell{
			display: table-cell;
			background-color: grey;
			padding: 0;
			width: 15px;
			height: 10px;
      border:#f0f0f0 1px solid;
		}
		.numeration{
			text-align: center;
		}
		.action-button{
			background-color: orange;			
		}

		<% board.each_index do |i| %>
			<% 4.times do |j|  %>
			<% nth_circle = %q{first second third fourth}.split %>
				<%= "#table-row-#{i + 1} .#{nth_circle[j]}{" %>
				<%= "background: #{board[i][0][j]};" %>				
				<%= "}" %>
				<% f = 1 %>
				<% board[i][1][:bulls].times do %>
					<%= "#table-row-#{i + 1} .feedback-#{f}{" %>
					<%= "background: red;" %>
					<%= "}" %>
					<% f += 1 %>
				<% end %>
				<% board[i][1][:cows].times do %>
					<%= "#table-row-#{i + 1} .feedback-#{f}{" %>
					<%= "background: white;" %>
					<%= "}" %>
					<% f += 1 %>
				<% end %>
			<% end %>
		<% end %>

		<% current_row = board.size %>


		#form div{
			display: inline;
		}
		.table-colours-container{
			position: absolute;
			margin-top: -25px;
			/*display: none;*/
		}		
		.table-of-colours{
			display: table;
			background: grey;
			border: 1px solid #000066;
		}
		.row-of-colours{
			display: table-row;
		}
		.cell-of-colours{
			display: table-cell;			
		}
		<% colours.each_index do |i| %>
			<%= ".colour-#{i}{"%>
			<%= "background: #{colours[i]};"%>
			<%= "margin: 3px;"%>
			
			<%= "width: 20px;"%>
			<%= "height: 20px;"%>
			}
		<% end %>
	</style>
</head>

<body>	

	<div class="center">
		<% if victory %>
			<div class="oval" id="victory-notification">
				<p>Master: "Congratulations! You have won!"</p>
			</div>
		<% else %>
			<div class="oval">
				<span>
					Master
				</span>								
			</div>
		<% end %>
		<div id="board">
			<div class="table">			
				<div class="table-row" id="table-row-12">
					<div class="table-cell numeration">12</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first">
				 			<!-- <div class="showme">Here I am!</div> -->
				 		</div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-11">
					<div class="table-cell numeration">11</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-10">
					<div class="table-cell numeration">10</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-9">
					<div class="table-cell numeration">9</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-8">
					<div class="table-cell numeration">8</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-7">
					<div class="table-cell numeration">7</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-6">
					<div class="table-cell numeration">6</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-5">
					<div class="table-cell numeration">5</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-4">
					<div class="table-cell numeration">4</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-3">
					<div class="table-cell numeration">3</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-2">
					<div class="table-cell numeration">2</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
				<div class="table-row" id="table-row-1">
					<div class="table-cell numeration">1</div>
				 	<div class="table-cell">				 		
				 		<div class="circle first"></div>
				 	</div>
			    <div class="table-cell">
			    	<div class="circle second"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle third"></div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle fourth"></div>
			    </div>
			    <div class="table-cell results">
			    	<div class="table-2">
			    		<div class="table-row">
			    			<div class="table-cell feedback-1"></div>
			    			<div class="table-cell feedback-2"></div>
			    		</div>
			    		<div class="table-row">
			    			<div class="table-cell feedback-3"></div>
			    			<div class="table-cell feedback-4"></div>
			    		</div>
			    	</div>
			    </div>
			    <div class="table-cell">
			    	<div class="circle action-button"></div>
			    </div>
				</div>
			</div>
		</div>		
	</div>



	<script src="http://code.jquery.com/jquery.js"></script>
	<script type="text/javascript">	
		
		
			<%= "$(\"#table-row-#{board.size + 1} .circle:not(.action-button)\").on('mouseleave', function(){ " %>
			
				$(this).empty();
			});
			$(".table-row .circle:not(.action-button)").on("click", ".circle", function(){
					var colour = $(this).css('background-color');
					closest = $(this).parents(".circle");
					closest.css("background-color", colour);
				});

			<%= "$(\"#table-row-#{board.size + 1} .circle:not(.action-button)\").on('mouseenter', function(){ " %>		
				var popup = 
					"<div class='table-colours-container'>" +
					"<div class='table-of-colours'>" + 
						"<div class='row-of-colours'>" +
							<% colours.size.times do |i| %>
								"<div class='cell-of-colours'>" +
									<%= "\"<div class='circle colour-#{i}'></div>\"" %>
								+ "</div>" +
							<% end %>
						"</div>" +
					"</div>" +
					"<div>";
				var palette = $(this).append( popup );	
			});	
	
			<% current_row = "#table-row-#{board.size + 1}" %>

			$("<%= current_row%> .action-button").on('click', function(){
				first_colour_back = $("<%=current_row %> .first").css("background-color")
				second_colour_back = $("<%=current_row %> .second").css("background-color")
				third_colour_back = $("<%=current_row %> .third").css("background-color")
				fourth_colour_back = $("<%=current_row %> .fourth").css("background-color")
				url = "http://localhost:4567/new_move";

			var form_string =	"<form method='post' action='/new_move' style='display: none'>" +
									"<input type='text' name='first_colour' value='"+ first_colour_back +
									"'><input type='text' name='second_colour' value='"+ second_colour_back +
									"'><input type='text' name='third_colour' value='"+ third_colour_back +
									"'><input type='text' name='fourth_colour' value='"+ fourth_colour_back +
									"'></form>";

			var form = $( form_string );			
			$(this).append(form);			
			form.submit();
			});
	</script>

	
</body>
</html>